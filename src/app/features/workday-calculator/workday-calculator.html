<app-window [instance]="instance">
  <div class="flex flex-col h-full w-full text-white text-sm">
    <!-- Personal setting controls -->
    <div class="px-2 py-1 text-sm text-gray-400">
      Time unit conversion:
    </div>
    <div class="flex items-center justify-between border-b border-[#444] px-2 py-1 text-xs text-white gap-4">
      <!-- Days per week -->
      <div class="flex items-center justify-end gap-2 flex-1">
        <button
          class="w-6 h-6 text-sm rounded bg-[#2a2a2a] hover:bg-[#3a3a3a]"
          (click)="adjustTempSetting('daysPerWeek', -1)"
        >−</button>
        <span class="w-4 text-center">{{ tempSettings().daysPerWeek }}d</span>
        <button
          class="w-6 h-6 text-sm rounded bg-[#2a2a2a] hover:bg-[#3a3a3a]"
          (click)="adjustTempSetting('daysPerWeek', 1)"
        >+</button>
        <span class="w-5">/ w</span>
      </div>

      <!-- Divider -->
      <div class="border-l border-[#444] h-5"></div>

      <!-- Hours per day -->
      <div class="flex items-center gap-2 flex-1">
        <button
          class="w-6 h-6 text-sm rounded bg-[#2a2a2a] hover:bg-[#3a3a3a]"
          (click)="adjustTempSetting('hoursPerDay', -1)"
        >−</button>
        <span class="w-4 text-center">{{ tempSettings().hoursPerDay }}h</span>
        <button
          class="w-6 h-6 text-sm rounded bg-[#2a2a2a] hover:bg-[#3a3a3a]"
          (click)="adjustTempSetting('hoursPerDay', 1)"
        >+</button>
        <span class="w-5">/ d</span>
      </div>

      <!-- Submit button -->
      <button
        class="px-3 py-1 rounded text-sm transition-all duration-100"
        [ngClass]="canApplySettings() ? {
          'bg-blue-600 hover:bg-blue-700 text-white shadow-md': true
        } : {
          'bg-[#2a2a2a] text-gray-400 opacity-50 cursor-not-allowed': true
        }"
        (click)="submitPersonalSettings()"
      >
        Apply
      </button>
    </div>

    @if (inputMeta(); as meta) {
      <!-- History display -->
      <div class="h-10 flex items-center justify-end overflow-auto border-b border-[#444] p-2 text-xs">
        {{ meta.history }}
      </div>

      <!-- Input result -->
      <div class="h-12 bg-[#111] border-b border-[#444] px-2 flex items-center justify-end font-mono text-base">
        {{ inputMeta().input || '0' }}
      </div>

      <!-- Error message -->
      <div class="h-5 px-2 flex items-center justify-end text-red-500 text-xs">
        {{ inputMeta().error ?? '' }}
      </div>
    }

    <!-- Key grid with unit buttons on the left -->
    <div class="flex flex-1 p-2 bg-[#1e1e1e] gap-4 select-none">
      
      <!-- Unit buttons (W, D, H, M) -->
      <div class="flex flex-col flex-1 max-w-[60px] gap-2">
        @for (unit of UNIT_KEYS; track unit) {
          <button
            class="flex-1 bg-[#2a2a2a] text-lg rounded flex items-center justify-center
              hover:bg-[#3a3a3a] disabled:hover:bg-[#2a2a2a]
              disabled:opacity-50 disabled:cursor-not-allowed"
            (click)="press(unit)"
            [disabled]="isUnitDisable()"
            [ngClass]="{ 'translate-y-[2px] ring ring-blue-500': activeKey() === unit }"
          >
            {{ unit }}
          </button>
        }
      </div>
      <!-- Main calculator key grid -->
      <div class="grid grid-cols-4 gap-1 flex-1 text-lg text-white">
        @for (key of CALCULATOR_KEYS; track key) {
          <button
            class="py-3 rounded flex items-center justify-center"
            [ngClass]="{
              'col-span-2': key === '0',
              'bg-[#2a2a2a] hover:bg-[#3a3a3a]': key !== CalculatorKeyInput.ENTER,
              'bg-blue-700 hover:bg-blue-800': key === CalculatorKeyInput.ENTER,
              'translate-y-[2px] ring ring-blue-500': activeKey() === key
            }"
            (click)="press(key)"
          >
            @if (CALCULATOR_KEY_DISPLAY[key]; as icon) {
              @if (typeof icon !== 'string') {
                <lucide-icon [img]="icon" class="w-5 h-5" />
              } @else {
                {{ icon }}
              }
            }
          </button>
        }
      </div>

    </div>
  </div>
</app-window>
